<!DOCTYPE html>
<html>
<head>
	<title>CheckId Demo</title>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

  <script src="https://code.jquery.com/jquery-3.3.1.min.js" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.1.0/handlebars.min.js" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
</head>
<body>
 
        <div class="container-view" id="verify">
          <div class="row">
            <div class="col-sm-8">
              <div class="card">
                <div class="card-header">
                  Verify
                </div>
                <div class="card-body">
                  <div class="form-group row">
                    <label for="inVerifyType" class="col-sm-2 col-form-label">Type</label>
                    <div class="col-sm-10">
                      <select class="form-control" id="inVerifyType">
                        <option value="">Any</option>
                        <option value="PIN">PIN</option>
                        <option value="FINGERPRINT">Fingerprint</option>
                      </select>
                    </div>
                  </div>
                  <div class="form-group row">
                    <label for="inVerifyDocCountryCode" class="col-sm-2 col-form-label">Country Code</label>
                    <div class="col-sm-10">
                      <input type="text" class="form-control" id="inVerifyDocCountryCode" value="CL">
                    </div>
                  </div>
                  <div class="form-group row">
                    <label for="inVerifyDocType" class="col-sm-2 col-form-label">Type</label>
                    <div class="col-sm-10">
                      <input type="text" class="form-control" id="inVerifyDocType" value="ID">
                    </div>
                  </div>
                  <div class="form-group row">
                    <label for="inVerifyDocPersonalNumber" class="col-sm-2 col-form-label">Personal Number</label>
                    <div class="col-sm-10">
                      <input type="text" class="form-control" id="inVerifyDocPersonalNumber" value="97643182">
                    </div>
                  </div>
                  <div class="form-group row">
                    <label for="inVerifyAuthenticationResult" class="col-sm-2 col-form-label">Authentication Result</label>
                    <div class="col-sm-10">
                      <input type="text" readonly class="form-control-plaintext" id="inVerifyAuthenticationResult" value="">
                    </div>
                  </div>
                  <button type="button" class="btn btn-primary" id="btn-verify">Verify</button>
                </div>
              </div>
            </div>
          </div>
        </div>



  <!-- Templates -->
  <script id="signer-list-template" type="text/x-handlebars-template" class="handlebars-template">
    {{#each signers}}
    <li class="list-group-item d-flex justify-content-between align-items-center">
      <span>{{docCountryCode}} {{docType}} {{docPersonalNumber}} {{authentication}} {{role}} {{@index}}</span>
      <a class="badge badge-primary badge-pill remove-signer" data-index="{{@index}}" href="#">delete</a>
    </li>
    {{/each}}
  </script>
  <script id="document-list-template" type="text/x-handlebars-template" class="handlebars-template">
    {{#each documents}}
    <li class="list-group-item d-flex justify-content-between align-items-center">
      <span>{{referenceName}} {{name}} {{fileName}} ID: {{id}}</span>
      <a class="badge badge-primary badge-pill remove-document" data-index="{{@index}}" href="#">delete</a>
    </li>
    {{/each}}
  </script>
  <script id="signer-status-list-template" type="text/x-handlebars-template" class="handlebars-template">
    {{#each signers}}
    <li class="list-group-item d-flex justify-content-between align-items-center">
      <span>{{identityDocument.countryCode}} {{identityDocument.type}} {{identityDocument.personalNumber}} {{role.code}} {{signState}} {{signStateDate}}</span>
    </li>
    {{/each}}
  </script>
  <script id="role-list-template" type="text/x-handlebars-template" class="handlebars-template">
    {{#each roles}}
    <li class="list-group-item d-flex justify-content-between align-items-center">
      <span>{{code}}</span>
    </li>
    {{/each}}
  </script>

  <script type="text/javascript">
    $(function(){
      $(".container-view").hide();

      let general = {
        //baseUrl: "",
        //baseUrl: "http://10.0.1.93",
        baseUrl: "https://qarubrika.solem.cl",
        apiKey: "c8f5e64dde44159c51791b14b1cfd93bd37f802149223529c2d49a0266ae8379",
        digitalSignature: 0,
        session: {
          id: "",
          companyId: "",
          username: ""
        },
        //currentAction: "CREATE"
        currentAction: "VERIFY",
        operator: {
          sessionId: null
        }
      };

      let signature = {
        signatureId: 0,
        signers: [],
        documents: []
      }

      let templates = { };

      $(".handlebars-template").each(function(key, item){
        let source   = $(this).html();
        let template = Handlebars.compile(source);
        templates[$(this).attr("id")] = template;
      });

      let showModal = function(title, content) {
        $("#title-modal").text(title);
        $("#content-modal").text(content);

        $("#alertModal").modal('show');
      };

      $("#loginForm").submit(function(e){
        e.preventDefault();
        if( $('#inputOperatorDocCountry').val() == '') {
          showModal('Alert', 'Empty fields');
          return false;
        }
        if( $('#inputOperatorType').val() == '') {
          showModal('Alert', 'Empty fields');
          return false;
        }
        if( $('#inputOperatorId').val() == '') {
          showModal('Alert', 'Empty fields');
          return false;
        }
        let requestData = {
          "code": "USER",
          "type": "START",
          "subtype": "SESSION",
          "createdAt": moment().format('YYYY-MM-DDTHH:mm:ss.SSS'),
          "id": 1549887978384,
          "client": {
            "operationId": 4965423403669707118,
            "companyId": $("#inputCompanyId").val(),
            "machineId": "",
            "username": $("#inputUsername").val(),
            "password": $("#inputPassword").val()
          }
        };

        $.ajax({
          method: "POST",
          contentType : "application/json",
          dataType: "json",
          crossDomain: true,
          url: general.baseUrl + "/api/v1/session",
          headers: {
            "X-Auth-Token": general.apiKey
          },
          data: JSON.stringify(requestData)
        })
        .done(function( json ) {
          general.session.id = json.client.token;
          general.session.companyId = $("#inputCompanyId").val();
          general.session.username = $("#inputUsername").val();
          $(".nav-link.nav-button").removeClass("disabled");
          $('#loginModal').modal('hide')
        });

        return false;
      });

      let loadSignForm = function(){
        $("#inSignId").val(general.digitalSignature);
        $("#inSignDocCountryCode").val($("#inVerifyDocCountryCode").val());
        $("#inSignDocType").val($("#inVerifyDocType").val());
        $("#inSignDocPersonalNumber").val($("#inVerifyDocPersonalNumber").val());
        if (general.lastVerify) {
          $("#inAuthenticationId").val(general.lastVerify.id);
          $("#inAuthenticationType").val(general.lastVerify.type);
          $("#inAuthenticationSubtype").val(general.lastVerify.subtype);
          $("#inAuthenticationMatch").val(general.lastVerify.authenticated);
          $("#inAuthenticationSign").val(general.lastVerify.sign);
        }
      };

      $(".nav-link.nav-button").click(function(e){
        e.preventDefault();
        $(".container-view").hide();
        /*
        if (general.sessionId != "") {
          $("#" + $(this).data("view")).show();
        }
        */
        $("#" + $(this).data("view")).show();
        if ($(this).data("view") == "sign"){
          loadSignForm();
        }

        return false;
      });

      let drawSignerList = function() {
        let html = templates["signer-list-template"](signature);
        $("#signer-list").html(html);

        $(".remove-signer").click(function(e){
          e.preventDefault();
          let index = parseInt($(this).data("index"));
          console.log('Remove signer ' + index, signature.signers);
          signature.signers.splice(index, 1);
          console.log('signer removed', signature.signers);
          drawSignerList();
        })
      }

      let drawDocumentList = function() {
        let html = templates["document-list-template"](signature);
        $("#document-list").html(html);

        $(".remove-document").click(function(e){
          e.preventDefault();
          signature.documents.splice($(this).data("index"), 1);
          drawDocumentList();
        })
      }

      $("#signer-form").submit(function(e){
        e.preventDefault();
        let signer = {
          docCountryCode: $("#inDocCountryCode").val(),
          docType: $("#inDocType").val(),
          docPersonalNumber: $("#inPersonalNumber").val(),
          authentication: $("#inAuthentication").val(),
          role: $("#inRole").val()
        };

        signature.signers.push(signer);

        drawSignerList();

        return false;
      });

      $("#document-form").submit(function(e){
        e.preventDefault();
        let file = $("#inDocFile")[0].files[0];
        let doc = {
          referenceName: $("#inDocReferenceName").val(),
          name: $("#inDocName").val(),
          fileName: file.name,
          file: file
        };

        signature.documents.push(doc);

        drawDocumentList();

        return false;
      });

      $("#btn-create-signature").click(function(){
        $("#btn-create-signature").addClass('disabled');
        let requestData = {
          "code": "SIGN",
          "type": "CREATE",
          "subtype": "SESSION",
          "createdAt": moment().format('YYYY-MM-DDTHH:mm:ss.SSS'),
          "id": 1549887978384,
          "client": {
            "operationId": 4965423403669707118,
            "companyId": general.session.companyId,
            "machineId": "",
            "username": general.session.username
          },
          "data": {
            "digitalSignature": {
              "sessionId": 0,
              "signers": [],
              "documentTotal" : signature.documents.length,
              "documents": []
            }
          }
        };

        let formData = new FormData();

        $.each(signature.signers, function(idx, signer){
          let signerRequest = {
            "identityDocument": {
              "countryCode": signer.docCountryCode,
              "personalNumber": signer.docPersonalNumber,
              "type": signer.docType
            },
            "authenticationFactorsCode": signer.authentication,
            "role": {
              "code": signer.role,
              "type": ""
            },
            "signingOrder": idx + 1
          };

          requestData.data.digitalSignature.signers.push(signerRequest);
        });

        $.each(signature.documents, function(idx, file){
          formData.append( file.referenceName, file.file );
          let documentRequest = {
              "referenceName": file.referenceName,
              "name": file.name
          };

          requestData.data.digitalSignature.documents.push(documentRequest);
        });

        console.log("Request:", requestData);

        var jsonBlob = new Blob([JSON.stringify(requestData)], { type: "application/json" }); // Se debe especificar el mimetype
        formData.append( 'content', jsonBlob);

        let url = general.baseUrl + "/api/v1/signature/";

        $.ajax({
          method: "POST",
          contentType : false,
          dataType: "json",
          crossDomain: true,
          url: url,
          headers: {
            "X-Auth-Token": general.apiKey,
            "X-Session-Token": general.session.id
          },
          mimeType: "multipart/form-data",
          processData: false,
          data: formData
        })
        .done(function( json ) {
          console.log("Success:", json);
          if (json.status.status.code == 200) {
            general.digitalSignature = json.data.digitalSignature.sessionId;
            signature.documents = json.data.digitalSignature.documents;
            drawDocumentList();

            showModal('Info', 'Process created: ' + general.digitalSignature);
          }
        })
        .fail(function( jqXHR, textStatus, errorThrown ) {
          if (jqXHR.responseJSON) {
            console.error("Error:", jqXHR.responseJSON);
          } else if (textStatus) {
            console.error("Error:", textStatus);
          }
        })
        .always(function(){
          $("#btn-create-signature").removeClass('disabled');
        });
      });

      let popupPage;
      let openCheckId = function(action) {
        general.currentAction = action;
        // Create popup window
        var w = 900;
        var h = 620;

        // Fixes dual-screen position                         Most browsers      Firefox
        var dualScreenLeft = window.screenLeft != undefined ? window.screenLeft : screen.left;
        var dualScreenTop = window.screenTop != undefined ? window.screenTop : screen.top;

        var width = window.innerWidth ? window.innerWidth : document.documentElement.clientWidth ? document.documentElement.clientWidth : screen.width;
        var height = window.innerHeight ? window.innerHeight : document.documentElement.clientHeight ? document.documentElement.clientHeight : screen.height;

        var left = ((width / 2) - (w / 2)) + dualScreenLeft;
        var top = ((height / 2) - (h / 2)) + dualScreenTop;

        var opciones = "toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=yes, resizable=no, width=" + w + ", height=" + h + ", top=" + top + ", left=" + left;
        popupPage = window.open("checkid/", "libPage", opciones);
        // Puts focus on the popupPage
        if (window.focus) {
          popupPage.focus();
        }
      };

      let getParamsVerify = function() {
        return {
          action: "VERIFY",
          method: $("#inVerifyType").val(),
          apiKey: general.apiKey,
          sessionId: general.session.id,
          companyId: general.session.companyId,
          operationId: 1,
          baseUrl: general.baseUrl,
          operator: {
            sessionId: general.operator.sessionId,
            identityDocument: {
                countryCode: $('#inputOperatorDocCountry').val(),
                type: $('#inputOperatorType').val(),
                personalNumber: $('#inputOperatorId').val()
            }
          },
          digitalIdentity: {
            identityDocuments: [{
              countryCode: $("#inVerifyDocCountryCode").val(),
              type: $("#inVerifyDocType").val(),
              personalNumber: $("#inVerifyDocPersonalNumber").val()
            }]
          }
          };
      };

      let getParamsCreate = function() {
        return {
            action: "CREATE",
	          apiKey: general.apiKey,
	          sessionId: general.session.id,
	          companyId: general.session.companyId,
	          operationId: 1,
	          baseUrl: general.baseUrl,
            useFingerprint: true,
            usePin: true,
            operator: {
              sessionId: general.operator.sessionId,
              identityDocument: {
                  countryCode: $('#inputOperatorDocCountry').val(),
                  type: $('#inputOperatorType').val(),
                  personalNumber: $('#inputOperatorId').val()
              }
            },
              digitalIdentity: {
                  personalData: {
                      givenNames: "desmond",
                      surnames: "miles",
                      dob: 20000101,
                      gender: "NOT_KNOWN"
                  },
                  emailAddresses: [
                    {
                        type: 'BUSINESS',
                        address: 'algo@algo.cl',
                        primary: true
                    },
                    {
                        type: 'PERSONAL',
                        address: 'algo@algo2.cl',
                        primary: false
                    }
                ],
                contactPhones: [
                    {
                        number: '+56982365612',
                        primary: false,
                        type: 'HOME'
                    },
                    {
                        number: '+56911111111',
                        primary: true,
                        type: 'PERSONAL'
                    }

                  ],
                  identityDocuments: [{
                    countryCode: $("#inCreateDocCountryCode").val(),
                    type: $("#inCreateDocType").val(),
                    personalNumber: $("#inCreateDocPersonalNumber").val()
                  }]
              }
          };
      };

      window.getParams = function() {
        if (general.currentAction == "CREATE") {
          return getParamsCreate();
        } else {
          return getParamsVerify();
        }
      }

      window.callback = function(result) {
          popupPage.close();
          console.log("callback", result);

          if (result.numError == 0) {
            if (result.action == "VERIFY") {
              let resultMessage = "No match";
              if (result.data.authenticated) {
                resultMessage = "Match";
              }

              general.lastVerify = result.data;

              $("#inVerifyAuthenticationResult").val(resultMessage);
            }

            general.operator.sessionId = result.operator.sessionId;
          }

          return false;
      }

      $("#btn-verify").click(function(){
        openCheckId("VERIFY");
      });

      $("#btn-create-person").click(function(){
        openCheckId("CREATE");
      });


      $("#btn-sign").click(function(){
        $("#btn-sign").addClass('disabled');
        let requestData = {
          "code": "SIGN",
          "type": "SIGN",
          "subtype": "SESSION",
          "createdAt": moment().format('YYYY-MM-DDTHH:mm:ss.SSS'),
          "id": 1549887978384,
          "client": {
            "operationId": 4965423403669707118,
            "companyId": general.session.companyId,
            "machineId": "",
            "username": general.session.username,
            "operator": {
              "identityDocument": {
                "countryCode": $('#inputOperatorDocCountry').val(),
                "type": $('#inputOperatorType').val(),
                "personalNumber": $('#inputOperatorId').val()
              }
            }
          },
          "data": {
            "digitalSignature": {
              "sessionId": $("#inSignId").val()
            },
            "digitalIdentity": {
              "identityDocuments": [
              {
                "countryCode": $("#inSignDocCountryCode").val(),
                "type": $("#inSignDocType").val(),
                "personalNumber": $("#inSignDocPersonalNumber").val()
              }]
            },
            "authenticationResult": general.lastVerify
          }
        };

        let url = general.baseUrl + "/api/v1/signature/sign";

        $.ajax({
          method: "POST",
          contentType : "application/json",
          dataType: "json",
          crossDomain: true,
          url: url,
          headers: {
            "X-Auth-Token": general.apiKey,
            "X-Session-Token": general.session.id
          },
          data: JSON.stringify(requestData)
        })
        .done(function( json ) {
          console.log("Success:", json);
          if (json.status.status.code == 200) {
            showModal('Info', 'Sign success');
          }
        })
        .fail(function( jqXHR, textStatus, errorThrown ) {
          if (jqXHR.responseJSON) {
            console.error("Error:", jqXHR.responseJSON);
          } else if (textStatus) {
            console.error("Error:", textStatus);
          }
          showModal('Alert', 'Sign error');
        })
        .always(function(){
          $("#btn-sign").removeClass('disabled');
        });
      });

      $("#btn-get-status-signature").click(function(){
        $("#btn-get-status-signature").addClass('disabled');
        let requestData = {
          "code": "SIGN",
          "type": "STATUS",
          "subtype": "SESSION",
          "createdAt": moment().format('YYYY-MM-DDTHH:mm:ss.SSS'),
          "id": 1549887978384,
          "client": {
            "operationId": 4965423403669707118,
            "companyId": general.session.companyId,
            "machineId": "",
            "username": general.session.username
          },
          "data": {
            "digitalSignature": {
              "sessionId": $("#inStatusSignId").val()
            }
          }
        };

        let url = general.baseUrl + "/api/v1/signature/status";

        $.ajax({
          method: "POST",
          contentType : "application/json",
          dataType: "json",
          crossDomain: true,
          url: url,
          headers: {
            "X-Auth-Token": general.apiKey,
            "X-Session-Token": general.session.id
          },
          data: JSON.stringify(requestData)
        })
        .done(function( json ) {
          console.log("Success:", json);
          if (json.status.status.code == 200) {
            $("#inStatusStatus").val(json.data.digitalSignature.sessionState);

            let html = templates["signer-status-list-template"](json.data.digitalSignature);
            $("#signer-status-list").html(html);
          }
        })
        .fail(function( jqXHR, textStatus, errorThrown ) {
          if (jqXHR.responseJSON) {
            console.error("Error:", jqXHR.responseJSON);
          } else if (textStatus) {
            console.error("Error:", textStatus);
          }
          showModal('Alert', 'Sign error');
        })
        .always(function(){
          $("#btn-get-status-signature").removeClass('disabled');
        });
      });

      $("#btn-download-document").click(function(){
        $("#btn-download-document").addClass('disabled');
        var img = document.getElementById('download-link');
        img.removeAttribute("href");
        let requestData = {
          "code": "SIGN",
          "type": "GET",
          "subtype": "DOCUMENT",
          "createdAt": moment().format('YYYY-MM-DDTHH:mm:ss.SSS'),
          "id": 1549887978384,
          "client": {
            "operationId": 4965423403669707118,
            "companyId": general.session.companyId,
            "machineId": "",
            "username": general.session.username
          },
          "data": {
            "digitalSignature": {
              "sessionId": $("#inDownloadSignId").val(),
              "documents": [
                {
                  id: $("#inDownloadDocId").val()
                }
              ]
            }
          }
        };

        let url = general.baseUrl + "/api/v1/document/raw";

        $.ajax({
          method: "POST",
          contentType : "application/json",
          //dataType: "json",
          crossDomain: true,
          url: url,
          headers: {
            "X-Auth-Token": general.apiKey,
            "X-Session-Token": general.session.id
          },
          data: JSON.stringify(requestData),
          xhrFields:{
            responseType: 'blob'
          }
        })
        .done(function( blob ) {
          console.log("Success");
          var url = window.URL || window.webkitURL;
          img.href = url.createObjectURL(blob);
        })
        .fail(function( jqXHR, textStatus, errorThrown ) {
          if (jqXHR.responseJSON) {
            console.error("Error:", jqXHR.responseJSON);
          } else if (textStatus) {
            console.error("Error:", textStatus);
          }
          showModal('Alert', 'Sign error');
        })
        .always(function(){
          $("#btn-download-document").removeClass('disabled');
        });
      });

      $("#btn-get-role").click(function(){
        $("#btn-add-role").addClass('disabled');
        $("#btn-get-role").addClass('disabled');
        $("#btn-remove-role").addClass('disabled');

        let requestData = {
          "code": "PERSON",
          "type": "GET",
          "subtype": "ROLE",
          "createdAt": moment().format('YYYY-MM-DDTHH:mm:ss.SSS'),
          "id": 1549887978384,
          "client": {
            "operationId": 4965423403669707118,
            "companyId": general.session.companyId,
            "machineId": "",
            "username": general.session.username
          },
          "data": {
            "digitalIdentity": {
              "identityDocuments": [
              {
                "countryCode": $("#inRoleDocCountryCode").val(),
                "type": $("#inRoleDocType").val(),
                "personalNumber": $("#inRoleDocPersonalNumber").val()
              }]
            }
          }
        };

        let url = general.baseUrl + "/api/v1/role/get";

        $.ajax({
          method: "POST",
          contentType : "application/json",
          dataType: "json",
          crossDomain: true,
          url: url,
          headers: {
            "X-Auth-Token": general.apiKey,
            "X-Session-Token": general.session.id
          },
          data: JSON.stringify(requestData)
        })
        .done(function( json ) {
          console.log("Success:", json);

          let html = templates["role-list-template"](json.data.digitalIdentity);
          $("#roles-list").html(html);

        })
        .fail(function( jqXHR, textStatus, errorThrown ) {
          if (jqXHR.responseJSON) {
            console.error("Error:", jqXHR.responseJSON);
          } else if (textStatus) {
            console.error("Error:", textStatus);
          }
          showModal('Alert', 'Role add error');
        })
        .always(function(){
          $("#btn-add-role").removeClass('disabled');
          $("#btn-remove-role").removeClass('disabled');
          $("#btn-get-role").removeClass('disabled');
        });
      });
      $("#btn-add-role").click(function(){
        $("#btn-add-role").addClass('disabled');
        $("#btn-get-role").addClass('disabled');
        $("#btn-remove-role").addClass('disabled');
        let requestData = {
          "code": "PERSON",
          "type": "ADD",
          "subtype": "ROLE",
          "createdAt": moment().format('YYYY-MM-DDTHH:mm:ss.SSS'),
          "id": 1549887978384,
          "client": {
            "operationId": 4965423403669707118,
            "companyId": general.session.companyId,
            "machineId": "",
            "username": general.session.username
          },
          "data": {
            "digitalIdentity": {
              "identityDocuments": [
              {
                "countryCode": $("#inRoleDocCountryCode").val(),
                "type": $("#inRoleDocType").val(),
                "personalNumber": $("#inRoleDocPersonalNumber").val()
              }],
              "roles": [
                {
                  "code": $("#inRoleCode").val()
                }
              ]
            }
          }
        };

        let url = general.baseUrl + "/api/v1/role/";

        $.ajax({
          method: "POST",
          contentType : "application/json",
          dataType: "json",
          crossDomain: true,
          url: url,
          headers: {
            "X-Auth-Token": general.apiKey,
            "X-Session-Token": general.session.id
          },
          data: JSON.stringify(requestData)
        })
        .done(function( json ) {
          console.log("Success:", json);
          showModal('Info', 'Role created');
        })
        .fail(function( jqXHR, textStatus, errorThrown ) {
          if (jqXHR.responseJSON) {
            console.error("Error:", jqXHR.responseJSON);
          } else if (textStatus) {
            console.error("Error:", textStatus);
          }
          showModal('Alert', 'Role add error');
        })
        .always(function(){
          $("#btn-add-role").removeClass('disabled');
          $("#btn-remove-role").removeClass('disabled');
          $("#btn-get-role").removeClass('disabled');
        });
      });
      $("#btn-remove-role").click(function(){
        $("#btn-add-role").addClass('disabled');
        $("#btn-remove-role").addClass('disabled');
        $("#btn-get-role").addClass('disabled');

        let requestData = {
          "code": "PERSON",
          "type": "REMOVE",
          "subtype": "ROLE",
          "createdAt": moment().format('YYYY-MM-DDTHH:mm:ss.SSS'),
          "id": 1549887978384,
          "client": {
            "operationId": 4965423403669707118,
            "companyId": general.session.companyId,
            "machineId": "",
            "username": general.session.username
          },
          "data": {
            "digitalIdentity": {
              "identityDocuments": [
              {
                "countryCode": $("#inRoleDocCountryCode").val(),
                "type": $("#inRoleDocType").val(),
                "personalNumber": $("#inRoleDocPersonalNumber").val()
              }],
              "roles": [
                {
                  "code": $("#inRoleCode").val()
                }
              ]
            }
          }
        };

        let url = general.baseUrl + "/api/v1/role/";

        $.ajax({
          method: "DELETE",
          contentType : "application/json",
          dataType: "json",
          crossDomain: true,
          url: url,
          headers: {
            "X-Auth-Token": general.apiKey,
            "X-Session-Token": general.session.id
          },
          data: JSON.stringify(requestData)
        })
        .done(function( json ) {
          console.log("Success:", json);
          showModal('Info', 'Role created');
        })
        .fail(function( jqXHR, textStatus, errorThrown ) {
          if (jqXHR.responseJSON) {
            console.error("Error:", jqXHR.responseJSON);
          } else if (textStatus) {
            console.error("Error:", textStatus);
          }
          showModal('Alert', 'Role add error');
        })
        .always(function(){
          $("#btn-add-role").removeClass('disabled');
          $("#btn-remove-role").removeClass('disabled');
          $("#btn-get-role").removeClass('disabled');
        });
      });
    });
  </script>
</body>
</html>