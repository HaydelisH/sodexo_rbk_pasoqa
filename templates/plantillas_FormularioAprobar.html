<div class="row">
  <div class="col-md-12">
    <div class="box">
      <div class="box-body pad table-responsive">
        <div class="box-header">
         <php:repeticion id="formulario">
           <form role="form" name="formulario2" id="formulario2" action="Plantillas.php" method="POST" >
              <input type="hidden" name="RutEmpresa" value='<php:item id="RutEmpresa"/>'/>
              <button type="submit" name="accion" value="BUSCAR" class="btn btn-default"/><a><i class="fa fa-arrow-left" aria-hidden="true"></i> Volver</a></button>
          </form>
        </div>
      <!-- /.box-header -->
      <div class="box-body">

        <div id="mensajeError"><php:texto id="mensajeError" /></div>
        <div id="mensajeOK"><php:texto id="mensajeOK" /></div>
        <div id="mensajeAd"><php:texto id="mensajeAd" /></div> 

        <form role="form" name="formulario" id="formulario_principal" action="Plantillas.php" method="POST" autocomplete="off">
         
         <div class="form-row">
           <div class="col-md-6">
              <label for="Titulo" >C&oacute;digo Plantilla</label>
              <!--idPlantilla-->
              <input type="text" class="form-control" id="idPlantilla" name="idPlantilla" value="<php:item id="idPlantilla"/>" readonly/>
                    
           </div>
         </div>
          <div class="form-row">            
              <!--Categorias-->
              <div class="col-md-6" style="padding-bottom: 15px;">
               
                  <label for="Categoria" >Categoria</label>
                  <!--Select de Empresas disponibles-->
                  <select class= "form-control" name="idCategoria" id="idCategoria" disabled>
                    <option value="0">(Seleccionar)</option>
                    <php:repeticion id="Categorias">
                      <option value="<php:item id="idCategoria" />" <php:funcion id="ContenedorUtilidades::evaluarSeleccion"><php:argumento id="idCategoria" /><php:argumento idvalor="idCategoria" /></php:funcion>><php:item id="Titulo" /></option>
                    </php:repeticion>
                  </select>
				  
				   <input type="hidden" name="idCategoria" id="idCategoria" value="<php:item id="idCategoria" />" />
              </div>
            <!--Fin del row-->
            </div>
             
             <div class="form-row">
              <!--Tipo de Documento-->
              <div class="col-md-6" style="padding-bottom: 15px;">
                  <label for="TipoDeDocumento" >Tipo de Documento</label>
                  <!--Select de Empresas disponibles-->
                  <select class= "form-control" name="idTipoDoc" id="idTipoDoc" disabled>
                    <option value="0">(Seleccionar)</option>
                    <php:repeticion id="TipoDocumentos">
                      <option value="<php:item id="idTipoDoc" />" <php:funcion id="ContenedorUtilidades::evaluarSeleccion"><php:argumento id="idTipoDoc" /><php:argumento idvalor="idTipoDoc" /></php:funcion>><php:item id="NombreTipoDoc" /></option>
                    </php:repeticion>
                  </select>
				  
				    <input type="hidden" id="idTipoDoc" name="idTipoDoc" value="<php:item id="idTipoDoc" />" />
              </div>
              <!--Workflow-->
              <div class="col-md-6" style="padding-bottom: 15px;">
               
                  <label for="Flujo" >Flujo de Firmas</label>
                  <!--Select de Empresas disponibles-->
                  <select class= "form-control" name="idWF" id="idWF" disabled>
                    <option value="0">(Seleccionar)</option>
                    <php:repeticion id="Flujos">
                      <option value="<php:item id="idWF" />" <php:funcion id="ContenedorUtilidades::evaluarSeleccion"><php:argumento id="idWF" /><php:argumento idvalor="idWF" /></php:funcion>><php:item id="NombreWF" /></option>
                    </php:repeticion>
                  </select>
				  
				   <input type="hidden" id="idWF" name="idWF" value="<php:item id="idWF" />" />
              </div>
            <!--Fin del row-->
            </div>
        
           
            <!--Titulo-->
            <div class="form-row">
              <div class="col-md-12">
                <label for="Titulo" >T&iacute;tulo</label>
                 <textarea id="TextoTxt" name="Titulo_Pl" rows="5" cols="80" disabled><php:item id="Titulo_Pl" /></textarea>
              </div>
            </div> 
            <!--Descripcion-->
            <div class="form-row">
              <div class="col-md-12">
                <label for="Descripcion">Descripci&oacute;n</label>
                <input type="text" class="form-control" id="Descripcion_Pl" name="Descripcion_Pl" value="<php:item id="Descripcion_Pl" />" placeholder="Descripcion" disabled>
              </div>
            </div>
                                       
         
          <div class="form-row"> 
            <!--Datos ocultos--> 
           
            <input type="hidden" name="accion" value="MODIFICAR" />
            <!--Boton de Clusulas-->
            <div class="col-md-2 xs-12">
              <button class="btn btn-md btn-default btn-block" type="submit" style="margin-top: 10px" data-toggle="collapse" href="#collapseExample" role="button" aria-expanded="false" aria-controls="collapseExample" name="accion2" value="CLAUSULAS" disabled=""><a href="">Clausulas</a></button>
            </div>
            <!--Boton de Generar-->
            <div class="col-md-2 xs-12 pull-right">
              <button class="btn btn-md btn-success btn-block" type="submit" style="margin-top: 10px" id="GENERAR" name="accion" value="GENERAR">Previsualizar</button>
            </div>
            <!--Boton para Modificar-->
            <div class="col-md-2 xs-12 pull-right">
               <input type="hidden" name="accion2" value="APROBAR" />
               <button class="btn btn-md btn-primary btn-block" type="button" style="margin-top: 10px" id="APROBAR" name="accion2" value="APROBAR"/>Aprobar</button>
            </div>           
          </div> 
                 
        </form> 
      </div>
    </div>
  </div>
</div>
</div>
   
  <!--Clausulas-->
  <div class="collapse" id="collapseExample" >
    <section class="content" style="padding-left: 0px; padding-right: 0px;">
      <div class="row">
        <div class="col-md-12">
          <div class="box">
            <div class="box-body pad table-responsive">
              <div class="box-header">
                <form role="form" name="formulario" id="formulario" action="Plantillas.php" method="POST">
                  <!--idCategoria-->
                  <input type="hidden" id="idCategoria" name="idCategoria" value="<php:texto id="idCategoria"/>"/>
                  <!--idPlantilla-->
                  <input type="hidden" id="idPlantilla" name="idPlantilla" value="<php:texto id="idPlantilla"/>"/>
                  <!--Boton de Agregar Clausulas-->
                  <button class="btn btn-md btn-default" style="margin-top: 10px" type="submit" name="accion" id="AGREGAR_CLAUSULA" value="AGREGAR_CLAUSULA"><a><i class="fa fa-plus" aria-hidden="true"></i>Agregar Clausula</a></button>
                </form>
              </div>
              <!-- /.box-header -->
              <div class="box-body">
                <div class="box-body pad table-responsive">
                  <div class="box-body">

                  <div id="divtabla" class="tabla-responsiva" >
                    <table id="example3" class="table table-bordered table-hover pagin-table">
                      <thead>
                       <tr>
                        <th data-campo="IDCLAUSULA" style="text-align: center;">Id Clausula </th>
                        <th data-campo="TITULO">Titulo </th>
                        <th data-campo="APROBADO">Revision </th>
                      </tr>
                      </thead>
                      <tbody >
                        <php:repeticion id="listado_clausulas">
                          <tr>
                            <td data-campo="IDCLAUSULA"><div style="text-align: center;"><php:item id="idClausula"/></div></td>
                            <td data-campo="TITULO" style="text-align: justify; padding: 20px;"><php:item id="Texto"/></td>
                            <td data-campo="APROBADO" style="text-align: center;"><php:item id="Aprobado"/></td>
                          </tr>
                        </php:repeticion>
                      </tbody>
                    </table> 
                   </div>
                   <!--./tabla-responsive--> 
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>

</php:repeticion>
</section>
             


<!--Tomar datos con ajax y reasigna datos de un selec a un input hidden-->
<script>

  $(document).ready(function(){

    if( $("#mensajeAd").html().length > 0 ){
        $("#mensajeAd").addClass("callout callout-warning");
        $("#GENERAR").attr("disabled", true);
    }
    else{
        $("#mensajeAd").removeClass("callout callout-warning");
        $("#GENERAR").attr("disabled", false);
    }
    if( $("#mensajeOK").html().length > 1 ){
      $("#APROBAR").attr("disabled",true);
    }

  });

  $("#APROBAR").click(function(){

    //Consultar si esta Plantilla existe para mas de una empresa 
    var idPlantilla = $("#idPlantilla").val();
    var url = "Plantillas_ajax3.php?idPlantilla=" + idPlantilla;

    // Creamos el control XMLHttpRequest segun el navegador en el que estemos 
    if( window.XMLHttpRequest )
      ajax = new XMLHttpRequest(); // No Internet Explorer
    else
      ajax = new ActiveXObject("Microsoft.XMLHTTP"); // Internet Explorer
   
    // Almacenamos en el control al funcion que se invocara cuando la peticion
    // cambie de estado 
    ajax.onreadystatechange = funcionCallback;

    // Enviamos la peticion
    ajax.open( "GET", url, true );
    ajax.send( "" );
  });

  var ajax;
  var salida;
   
  function funcionCallback()
  {
    // Comprobamos si la peticion se ha completado (estado 4)
    if( ajax.readyState == 4 )
    {
      // Comprobamos si la respuesta ha sido correcta (resultado HTTP 200)
      if( ajax.status == 200 )
      {
        // Escribimos el resultado en la pagina HTML mediante DHTML
        salida = ajax.responseText;

        if( salida == '1' ){
          var respuesta = confirm("Esta Plantilla esta asociada a más de una Empresa, desea continuar ?");

          if( respuesta ){
            $("#formulario_principal").submit();
          }
        }else{
           $("#formulario_principal").submit();
        }
      }
    }
  }

</script>



  

