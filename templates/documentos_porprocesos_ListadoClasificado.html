<div class="row" >
  <div class="col-md-12">
    <div class="box">
      <div class="box-body pad table-responsive"> 
        <div class="box-body">
           <!--Mensajes-->
          <div id="mensajeOK"><php:texto id="mensajeOK" /></div>
          <div id="mensajeError"><php:texto id="mensajeError" /></div>   

			<div class="box-header">
				<a class="btn btn-default btn_letra_azul" href="Documentos_PorProcesos.php" ><i class="fa fa-arrow-left" aria-hidden="true"></i> Volver</a>
			</div>   

        </div>
        <form name="formulario2" id="formulario_usuarios" action="Documentos_PorProcesos.php" method="POST" autocomplete="off">

          <table id="example2" class="table table-bordered table-hover">
	          <div class="col-md-2 xs-12">
		          <button class="btn btn-md btn-default btn-block ocultar" type="button" style="margin-top: 10px" data-toggle="collapse" href="#collapseExample" role="button" data-parent="#accordion"><a id="a">Ocultar Filtro</a></button>
	          </div>
          </table>
  			
  		    <div id="collapseExample"  class="panel-collapse collapse in">
      			<div class="col-md-12">
      				<div class="box">
      					<div class="box-body pad table-responsive">
      					  <div class="box-header">
      						  <div class="form-group">
							 
							 	<php:repeticion id="formulario">
   										
									<!--Numero e Contrato-->
									<div class="form-row">
										<div class="col-md-4 xs-12">
										<label for="idDocumento">Nro Documento</label>
										<input type="text" class="form-control" id="idDocumento" name="idDocumento" maxlength="10" value="<php:item id="idDocumento" />" placeholder="Nro Documento"/>
										</div>
									</div>

									<!--Tipo de Documento-->
									<div class="form-row">
										<div class="col-md-4 xs-12">
									 	 <label for="NombreTipoDoc">Tipo Documento</label>
											<select class= "form-control" name="idTipoDoc" id="idTipoDoc" >
												<option value="0">(Seleccione)</option>
												<php:repeticion id="tiposdocumentos">			
													<option value="<php:item id="idTipoDoc" />" <php:funcion id="ContenedorUtilidades::evaluarSeleccion"><php:argumento id="idTipoDoc" /><php:argumento idvalor="idTipoDoc" /></php:funcion>><php:item id="NombreTipoDoc" /></option>
												</php:repeticion>
											</select>										  
										</div>
									</div>

									<!--Proceso-->
									<div class="form-row" style="display:none;">
										<div class="col-md-4 xs-12">
											<label for="Nombre">Proceso</label>	
											<select class="form-control" name="idProceso" id="idProceso" >
												<option value="0">(Seleccione)</option>
												<php:repeticion id="Procesos">						
													<option value="<php:item id="idProceso" />" <php:funcion id="ContenedorUtilidades::evaluarSeleccion"><php:argumento id="idProceso" /><php:argumento idvalor="idProceso" /></php:funcion>><php:item id="Descripcion" /></option>
												</php:repeticion>
											</select>	
										</div>
									</div>


									<!--Estado de firma de Documento-->
									<div class="form-row">
										<div class="col-md-4 xs-12">
										<label for="Nombre">Estado Documento</label>	
											<select class="form-control" name="idEstado" id="idEstado" >
												<option value="0">(Seleccione)</option>
												<php:repeticion id="estadocontratos">			
													<option value="<php:item id="idEstado" />" <php:funcion id="ContenedorUtilidades::evaluarSeleccion"><php:argumento id="idEstado" /><php:argumento idvalor="idEstado" /></php:funcion>><php:item id="Descripcion" /></option>
												</php:repeticion>
											</select>	
										</div>
									</div>

									<!--Tipo de firma del Documento-->
									<div class="form-row">
										<div class="col-md-4 xs-12">
											<label for="Nombre">Tipo de Firma</label>	
											<select class="form-control" name="idTipoFirma" id="idTipoFirma" >
												<option value="0">(Seleccione)</option>
												<php:repeticion id="TipoFirmas">						
													<option value="<php:item id="idTipoFirma" />" <php:funcion id="ContenedorUtilidades::evaluarSeleccion"><php:argumento id="idTipoFirma" /><php:argumento idvalor="idTipoFirma" /></php:funcion>><php:item id="Descripcion" /></option>
												</php:repeticion>
											</select>	
										</div>
									</div>

									
									<!--Firmante-->
									<div class="form-row">
										<div class="col-md-4 xs-12">
									 		<label for="Firmante">Firmante ( Rut o Nombre )</label>
									  		<input type="text" class="form-control" id="Firmante" name="Firmante" maxlength="50" value="<php:item id="Firmante" />" placeholder="Firmante ( Rut o Nombre )" />
										</div>
									</div>

									<!--Empresas-->
									<div class="col-md-4" style="padding-bottom: 15px;">
										<label for="Empresa" >Empresa (*)</label>
										<!--Select de Empresas disponibles-->
										<select class= "form-control" name="RutEmpresa" id="RutEmpresa">
											<option value="0">( Seleccione )</option>
											<php:repeticion id="Empresas">
											<option value="<php:item id="RutEmpresa" />" <php:funcion id="ContenedorUtilidades::evaluarSeleccion"><php:argumento id="RutEmpresa" /><php:argumento idvalor="RutEmpresa" /></php:funcion>><php:item id="RazonSocial" /></option>
											</php:repeticion>
										</select>
									</div>
									<!--Gerencia-->
									<div class="form-row">
										<div class="col-md-4 xs-12">
											<label>Gerencia (*) </label>
											<select class= "form-control" name="lugarpagoid" id="lugarpagoid" disabled>
												<option value="0">( Seleccione )</option>
												<php:repeticion id="lugarespago">
												<option class="fila_lp" value="<php:item id="lugarpagoid" />" <php:funcion id="ContenedorUtilidades::evaluarSeleccion"><php:argumento id="lugarpagoid" /><php:argumento idvalor="lugarpagoid" /></php:funcion>><php:item id="nombrelugarpago" /></option>
												</php:repeticion>
											</select>
										</div>
									</div>
									<!--Campos basicos-->		
									<div class="form-row">
										<div class="col-md-4 xs-12">
											<label>Centro costo (*) </label>
											<select class= "form-control" name="idCentroCosto" id="idCentroCosto" disabled>
												<option value="0">( Seleccione )</option>
												<php:repeticion id="centrocosto">
												<option class="fila_cc" value="<php:item id="idCentroCosto" />" <php:funcion id="ContenedorUtilidades::evaluarSeleccion"><php:argumento id="idCentroCosto" /><php:argumento idvalor="idCentroCosto" /></php:funcion>><php:item id="nombrecentrocosto" /></option>
												</php:repeticion>
											</select>
										</div>
									</div>
									<!--div class="form-row">
										<div class="col-md-4 xs-12">
											<label for="idCentroCosto">Centro costo</label>
											<input type="text" class="form-control" id="idCentroCosto" name="idCentroCosto" maxlength="10" value="<php:item id="idCentroCosto" />" placeholder="Centro costo"  disabled> 
										</div>
									</div-->

									<div class="form-row">
										<div class="col-md-2 xs-12 pull-right"  style="margin-top: 15px;">
											<input type="hidden" name="accion" value="DOCUMENTOS" />
											<button class="btn btn-md btn-primary btn-block"  name="accion2" type="submit" value="DOCUMENTOS">Buscar</button>
										</div>
									</div>
	                    		</div> <!-- <div class="form-group">-->
	                  		</div> <!--<div class="box-header">-->
	               		</div> <!-- <div class="box-body pad table-responsive">-->
	              	</div> <!-- <div class="box">-->
	            </div> <!-- <div class="col-md-12">-->
	          	<!--</div><div class="row"> -->
	      	</div> <!-- <div class="collapse" id="collapseExample"> -->
	    </form>
       
       
           <!--Tabla-->
				  
		<div id="divtabla" class="tabla-responsiva" >
		   <div class="col-md-12">
			<table id="example" class="table table-bordered table-hover " name="tbltabla">
				  <thead>
					<tr>
						<th style="text-align: center;" data-campo="Nro Documento">Nro Documento</th>
						<th style="text-align: center;" data-campo="Tipo Documento">Tipo Documento </th>
						<th style="text-align: center;" bdata-campo="Proceso">Proceso </th>
						<th style="text-align: center;" bdata-campo="CentroCosto">Centro Costo </th>
						<th style="text-align: center;" data-campo="Estado">Estado</th>
						<th style="text-align: center;" data-campo="TipoFirma">Tipo de Firma</th>
						<th style="text-align: center;" data-campo="Fecga Creacion">Fecha de creaci&oacute;n</th>
						<th style="text-align: center;" bdata-campo="RutFirmante">Rut Firmante</th>
						<th style="text-align: center;" data-campo="Nombre Firmante">Nombre Firmante</th>
						<th style="text-align: center;" data-campo="RutEmpleado">Rut Empleado</th>
						<th style="text-align: center;" data-campo="Empleado">Empleado</th>		
						<th style="text-align: center;" data-campo="Detalle">Detalle</th>
					</tr>
				  </thead>
				<tbody>
				
				<!--Contenido de Tabla-->
				<php:repeticion id="listado">
				  <tr>
					<td style="text-align: center;" data-campo="Nro Documento"><php:item id="idDocumento" /></td>
					<td style="text-align: center;" data-campo="Tipo Documento"><php:item id="NombreTipoDoc" /></td>
					<td style="text-align: center;" data-campo="Proceso"><php:item id="Proceso" /></td>
					<td style="text-align: center;" data-campo="CentroCosto"><php:item id="CentroCosto" /></td>
					<td style="text-align: center;" data-campo="Estado"><php:item id="Estado" /></td>
					<td style="text-align: center;" data-campo="TipoFirma"><php:item id="Firma" /></td>
					<td style="text-align: center;" data-campo="Estado"><php:item id="FechaCreacion" /></td>	
					<td style="text-align: center;" data-campo="Rut Firmante"><php:item id="RutRep" /></td>
					<td style="text-align: center;" data-campo="Nombre Firmante"><php:item id="nombre_rep" /> <php:item id="appaterno_rep" /> <php:item id="apmaterno_rep" /></td>
					<td style="text-align: center;" data-campo=Rut"><php:item id="Rut" /></td>
					<td style="text-align: center;" data-campo="Empleado"><php:item id="nombre" /> <php:item id="appaterno" /> <php:item id="apmaterno" /></td>					
					<td data-campo="Detalle">
					  <form name="formulario" id="formulario_tipo" action="Documentos_PorProcesos.php" method="POST">
						   <input type="hidden" name="idDocumento" value="<php:item id="idDocumento" />">
						   <input type="hidden" name="pagina" value="<php:texto id="pagina" />">
						   <input type="hidden" name="nombrex" value="<php:texto id="nombrex" />">
						   <button class="btn btn-primary btn-sm" type="submit" name="accion" value="DETALLE" >Detalle</button>
					  </form>
					</td>
				  </tr>
				</php:repeticion>
				</tbody>
				
				<th colspan=13 class="tabla_abajo">
					<div class="col-md-12" style="font-weight: normal;">
                     	<php:item id="pagina_actual" /> de <php:item id="pagina_ultimo" /> - Total <php:item id="total_registros" /> Registros
                  	</div>
				  <div class="col-xs-offset-5"> 
					<nav aria-label="nav1">
					  <ul class="pagination justify-content-center" style="margin-top: 0px; margin-bottom: 0px;">
						<li class="page-item ">
						  <a id="pagina_primera" class="page-link" href="#" tabindex="-1" onclick="javascript:proc_paginado(<php:item id="pagina_primera" />);" ><span><i class="fa fa-angle-double-left"></i></span></a>
						</li>
						<li class="page-item ">
						  <a id="pagina_anterior" class="page-link" href="#" tabindex="-1" onclick="javascript:proc_paginado(<php:item id="pagina_anterior" />);" ><span ><i class="fa fa-angle-left"></i></span></a>
						</li>                  
						<li class="page-item active"><a class="page-link1" href="#"><php:item id="pagina_actual" /></a></li>                              
						<li class="page-item">
						  <a id="pagina_siguente" class="page-link" href="#" onclick="javascript:proc_paginado(<php:item id="pagina_siguente" />);" ><span><i class="fa fa-angle-right"></i></span></a>
						</li>
					  <li class="page-item">
						<a id="pagina_ultimo" class="page-link" href="#" onclick="javascript:proc_paginado(<php:item id="pagina_ultimo" />);" ><span><i class="fa fa-angle-double-right"></i></span></a>
					  </li>                                                     
					  </ul>
					</nav>
				  </div>

				  	<div class="col-md-2 pull-right">
						<form action="Reportes_Excel.php" method="POST" name="formulario4" id="formulario4" >

							<!--Datos necesarios para generar reportes-->
							<input type="hidden" name="idDocumento" value="<php:item id="idDocumento" />" >
							<input type="hidden" name="idTipoDoc" value="<php:item id="idTipoDoc" />" >
							<input type="hidden" name="idEstado" value="<php:item id="idEstado" />" >
							<input type="hidden" name="idTipoFirma" value="<php:item id="idTipoFirma" />" >
							<input type="hidden" name="idProceso" value="<php:item id="idProceso" />" >
							<input type="hidden" name="Firmante"    value="<php:item id="Firmante" />" >
							
							<button type="submit" name="accion" id="accion" value="DESCARGAR" class="form-control btn btn-md btn-primary"><i class="fa fa-file-excel-o" aria-hidden="true"></i> Descargar</button>
						</form>
					</div>

				  </th>

				<form name="paginado" id="paginado" action="Documentos_PorProcesos.php" method="POST" >
					<input type="hidden" name="pagina" value="" id="pagina" >
					<input type="hidden" name="holdingid" value="<php:item id="holdingid" />" >
					<input type="hidden" name="idDocumento" value="<php:item id="idDocumento" />" >
					<input type="hidden" name="idTipoDoc" value="<php:item id="idTipoDoc" />" >
					<input type="hidden" name="idEstado" value="<php:item id="idEstado" />" >
					<input type="hidden" name="idTipoFirma" value="<php:item id="idTipoFirma" />" >
					<input type="hidden" name="idProceso" value="<php:item id="idProceso" />" >
					<input type="hidden" name="Firmante"    value="<php:item id="Firmante" />" >
					<input type="hidden" name="accion" value="DOCUMENTOS">
				</form>
	
			</table>
		</div>
       </php:repeticion>

      </div>
    </div>
  </div>
</div> 
</section>
    
<script>
	
	$(".ocultar").click(function(){

	if ( $("#collapseExample").hasClass('in')){
		$("#a").html('Mostrar filtros');
	}else{
  		$("#a").html('Ocultar filtros');
  	}

 });
 $(document).ready(function(){
		var lugarpagoid = $("#lugarpagoid").val();
		var RutEmpresa = $("#RutEmpresa").val();
		var centrocostoid = $("#idCentroCosto").val();
		//console.log(RutEmpresa);
		if( RutEmpresa != '' ) {
			$("#lugarpagoid").attr("disabled",false);
		}
		if( RutEmpresa == 0 ){
			$("#lugarpagoid").attr("disabled",true);
		}
		if ( lugarpagoid != 0 ){
			$("#idCentroCosto").attr("disabled", false);
			//llamaCambioLugarPago();
		}else{
			$("#idCentroCosto").attr("disabled", true);
		}
	});
	
	$("#RutEmpresa").change(function(){ 
		$(".fila_lp").remove();
		$(".fila_cc").remove();
		ActualizarLugaresPago(); 
	});
	
	function ActualizarLugaresPago(){
		var RutEmpresa = $("#RutEmpresa").val();
		if( RutEmpresa == 0 ){
			//$("#mensajeError").addClass("callout callout-warning");
			//$("#mensajeError").html("Debe seleccionar la Empresa");
			$("#lugarpagoid").attr("disabled",true);
			return false;
		}else{
			$("#mensajeError").html("");
			$("#mensajeError").removeClass("callout callout-warning");
			var url  = "CentroCosto_ajax.php?RutEmpresa=" + RutEmpresa;
			// Creamos el control XMLHttpRequest segun el navegador en el que estemos 
			if( window.XMLHttpRequest )
				ajaxLugarPago = new XMLHttpRequest(); // No Internet Explorer
			else
				ajaxLugarPago = new ActiveXObject("Microsoft.XMLHTTP"); // Internet Explorer
			// Almacenamos en el control al funcion que se invocara cuando la peticion
			// cambie de estado 
			ajaxLugarPago.onreadystatechange = funcionCallback_rutempresa;
			// Enviamos la peticion
			ajaxLugarPago.open( "GET", url, false );
			ajaxLugarPago.send( "" );
		}
	}

	function funcionCallback_rutempresa()
  	{
		// Comprobamos si la peticion se ha completado (estado 4)
		if( ajaxLugarPago.readyState == 4 )
		{
			// Comprobamos si la respuesta ha sido correcta (resultado HTTP 200)
			if( ajaxLugarPago.status == 200 )
			{
				// Escribimos el resultado en la pagina HTML mediante DHTML
				salida = ajaxLugarPago.responseText;
				listado = JSON.parse(salida);
				num = listado.length;
				if( num > 0 ){
					$.each(listado, function( index, value ) {
						$('#lugarpagoid').append('<option class="fila_lp" value=' + listado[index].lugarpagoid + '>' + listado[index].nombrelugarpago + ' </option>');    
					});
					$("#lugarpagoid").attr("disabled", false);
				}
			}
		}
	}
  
	$("#lugarpagoid").change(function(){
		$(".fila_cc").remove();
		llamaCambioLugarPago();
	});

	function llamaCambioLugarPago()
	{
		var lugarpagoid = $("#lugarpagoid").val();
		var RutEmpresa = $("#RutEmpresa").val();
		if ( lugarpagoid != 0 ){
			$("#mensajeError").html("");
			$("#mensajeError").removeClass("callout callout-warning");
			var url  = "LugarPago_ajax.php?lugarpagoid=" + lugarpagoid + '&RutEmpresa=' + RutEmpresa;
			// Creamos el control XMLHttpRequest segun el navegador en el que estemos 
			if( window.XMLHttpRequest )
				ajaxCentroCosto = new XMLHttpRequest(); // No Internet Explorer
			else
				ajaxCentroCosto = new ActiveXObject("Microsoft.XMLHTTP"); // Internet Explorer
			// Almacenamos en el control al funcion que se invocara cuando la peticion
			// cambie de estado 
			ajaxCentroCosto.onreadystatechange = funcionCallback_lugarpago;
			// Enviamos la peticion
			ajaxCentroCosto.open( "GET", url, false );
			ajaxCentroCosto.send( "" );
		}else{
			$("#idCentroCosto").attr("disabled", true);
			//$("#nombreCentroCosto").attr("disabled", true);
		}
	}
	function funcionCallback_lugarpago()
	{
		// Comprobamos si la peticion se ha completado (estado 4)
		if( ajaxCentroCosto.readyState == 4 )
		{
			// Comprobamos si la respuesta ha sido correcta (resultado HTTP 200)
			if( ajaxCentroCosto.status == 200 )
			{
				// Escribimos el resultado en la pagina HTML mediante DHTML
				salida = ajaxCentroCosto.responseText;
				listado = JSON.parse(salida);
				num = listado.length;
				//$('#idCentroCosto').append('<option value="0">( Seleccione )</option>');    
				if( num > 0 ){
					$.each(listado, function( index, value ) {
						$('#idCentroCosto').append('<option class="fila_cc" value=' + listado[index].idCentroCosto + '>' + listado[index].nombrecentrocosto + ' </option>');    
					});
					$("#idCentroCosto").attr("disabled", false);
				}
			}
		}
	}
</script>